sudo -S apt-get updat
sudo -S apt install -y python3-pip python3-pil python3-smbus python3-matplotlib cmake

# add 4 GB swap file
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
sudo swapon --show
sudo cp /etc/fstab /etc/fstab.bak
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# max frequency & power
sudo jetson_clocks
sudo nvpmodel -m 0

# dependencies
sudo apt install -y git \
cmake \
libatlas-base-dev \
 gfortran \
python3-dev \
python3-pip \
libhdf5-serial-dev \
hdf5-tools

# install pip 
cd ~
wget https://bootstrap.pypa.io/get-pip.py
sudo python get-pip.py
rm get-pip.py

# python modeuls in user directory
pip install -U pip setuptools --user
pip install --user numpy
pip install --user --extra-index-url https://developer.download.nvidia.com/compute/redist/jp/v42 tensorflow-gpu==1.13.1+nv19.3
pip install --user keras
pip install --user jupyter
pip install --user pillow
sudo apt-get install libfreetype6-dev
pip install --user matplotlib

# verify installs
python -c 'import numpy; print(numpy.__version__)'
python -c 'import tensorflow; print(tensorflow.__version__)'
python -c 'import keras; print(keras.__version__)'
python -c 'import jupyter; print(jupyter.__version__)'
python -c 'import PIL; print(PIL.__version__)'
python -c 'import matplotlib; print(matplotlib.__version__)'

# Python 2.7 install torch
wget https://nvidia.box.com/shared/static/1v2cc4ro6zvsbu0p8h6qcuaqco1qcsif.whl -O torch-1.4.0-cp27-cp27mu-linux_aarch64.whl
sudo apt-get install libopenblas-base libopenmpi-dev 
pip install torch-1.4.0-cp27-cp27mu-linux_aarch64.whl

# Python 3.6 install torch
wget https://nvidia.box.com/shared/static/ncgzus5o23uck9i5oth2n8n06k340l6k.whl -O torch-1.4.0-cp36-cp36m-linux_aarch64.whl
sudo apt-get install python3-pip libopenblas-base libopenmpi-dev 
pip3 install Cython
pip3 install numpy torch-1.4.0-cp36-cp36m-linux_aarch64.whl

# instal torchvision
sudo apt-get install libjpeg-dev zlib1g-dev
# git clone --branch <version> https://github.com/pytorch/vision torchvision  
# git clone --branch v0.5.0 https://github.com/pytorch/vision torchvision
# see below for version of torchvision to download
# PyTorch v1.0 - torchvision v0.2.2
# PyTorch v1.1 - torchvision v0.3.0
# PyTorch v1.2 - torchvision v0.4.0
# PyTorch v1.3 - torchvision v0.4.2
# PyTorch v1.4 - torchvision v0.5.0
# PyTorch v1.5 - torchvision v0.6.0
sudo python setup.py install
cd torchvision
sudo apt-get install python-future
pip install --user requests
sudo python setup.py install
cd ../  # attempting to load torchvision from build dir will result in import error
pip install 'pillow<7' # not needed for torchvision v0.5.0+

# verification
>>> import torch
>>> print(torch.__version__)
>>> print('CUDA available: ' + str(torch.cuda.is_available()))
>>> print('cuDNN version: ' + str(torch.backends.cudnn.version()))
>>> a = torch.cuda.FloatTensor(2).zero_()
>>> print('Tensor a = ' + str(a))
>>> b = torch.randn(2).cuda()
>>> print('Tensor b = ' + str(b))
>>> c = a + b
>>> print('Tensor c = ' + str(c))
>>> import torchvision
>>> print(torchvision.__version__)
